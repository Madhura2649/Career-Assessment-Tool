<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="card">
    <h2>Admin â€” Manage Questions</h2>

    <div>
      <button id="load-default" class="btn outline">Load Defaults</button>
      <button id="save-local" class="btn">Save to Browser</button>
      <button id="export-json" class="btn">Export JSON</button>
      <input id="file-input" type="file" accept=".json" style="display:none;">
      <button id="import-json" class="btn outline">Import JSON</button>
    </div>

    <div class="editor">
      <textarea id="questions-text" rows="18"></textarea>
    </div>

    <div class="btn-row">
      <a class="btn" href="index.html">Home</a>
      <a class="btn outline" href="student.html">Open Student View</a>
    </div>

    <div class="small-note">Edit questions as JSON array. Format shown below.</div>
  </main>

  <script src="script.js"></script>
  <script>
    (async function () {
      const ta = document.getElementById('questions-text');
      const loadDefaultBtn = document.getElementById('load-default');
      const saveLocal = document.getElementById('save-local');
      const exportBtn = document.getElementById('export-json');
      const importBtn = document.getElementById('import-json');
      const fileInput = document.getElementById('file-input');

      async function load() {
        const q = await CA.loadQuestions();
        ta.value = JSON.stringify(q, null, 2);
      }

      load();

      loadDefaultBtn.onclick = async () => {
        const defaults = await CA.fetchDefaultQuestions();
        ta.value = JSON.stringify(defaults, null, 2);
      };

      saveLocal.onclick = () => {
        try {
          const parsed = JSON.parse(ta.value);
          localStorage.setItem('ca_questions', JSON.stringify(parsed));
          alert('Saved to browser storage (localStorage). Student view will use these questions.');
        } catch (e) {
          alert('Invalid JSON: ' + e.message);
        }
      };

      exportBtn.onclick = () => {
        const data = ta.value;
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'questions.json';
        a.click();
        URL.revokeObjectURL(url);
      };

      importBtn.onclick = () => fileInput.click();
      fileInput.onchange = () => {
        const f = fileInput.files[0];
        if (!f) return;
        const reader = new FileReader();
        reader.onload = e => {
          ta.value = e.target.result;
        };
        reader.readAsText(f);
      };
    })();
  </script>
</body>
</html>
